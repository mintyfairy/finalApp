<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fa.plus.mapper.SiteBookMapper">

	<insert id="insertCart" parameterType="com.fa.plus.domain.site.SiteCart">
		insert into sitecart(MEMBERIDX,DETAILNUM,STARTDATE,ENDDATE,REG_DATE	) 
  			  values(#{memberIdx},#{detailNum},#{startDate},#{endDate},#{reg_date})
		
	</insert>
	<delete id="deleteCart" parameterType="com.fa.plus.domain.site.SiteCart">
		DELETE FROM sitecart WHERE  detailNum = #{detailNum} and memberIdx=#{memberIdx}
	</delete>
	
	<select id="listCart" parameterType="String" resultType="com.fa.plus.domain.site.SiteCart">
		SELECT MEMBERIDX,sitecart.DETAILNUM,STARTDATE,ENDDATE,detailname,price,content,capacity,floor
		FROM sitecart join sitedetail  on sitedetail.DETAILNUM=sitecart.DETAILNUM
		WHERE memberIdx=#{memberIdx}
	</select>
	
	
	<insert id="insertBookList" parameterType="map">
		insert into booklist(LISTNUM,ORDER_DATE,MEMBERIDX,TOTALPRICE,STATE) 
			values(booklist_seq.nextval,sysdate,#{memberIdx},#{totalPrice},0)
		
	</insert>
	
	<insert id="insertBook" parameterType="com.fa.plus.domain.site.SiteCart">
		insert into book(BOOKNUM,STARTDATE,ENDDATE ,BOOKPRICE ,DETAILNUM ,LISTNUM) 
			VALUES(book_seq.nextval,#{startDate},#{endDate},#{bookPrice},#{detailNum},booklist_seq.currval)
		
	</insert>
	
	<insert id="perchaseSite" parameterType="map">
		INSERT into bookpayment(BOOKNUM,PURCHASECOST,PURCHASEMETHOD,PURCHASEDATE) 
		values(booklist_seq.currval,#{totalPrice},#{perchaseMethod},sysdate)
		
	</insert>
	<delete id="deleteAllCart" parameterType="long">
		DELETE FROM sitecart WHERE memberIdx=#{memberIdx}
	</delete>
	
	
<!-- 리뷰 등록될떄마다 갱신 -->
<!-- update test set avenum=round((select avg(totalmoney) from productorder)/1000000,1) where num=1; -->
</mapper>